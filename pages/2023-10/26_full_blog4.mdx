# Full Blog4【Next.js】


## markdownファイルを追加する
- ルートディレクトリにマークダウンファイル設置し、データソースとして読み込む
- yamlフォーマットでメタデータを記述することができる
```a {5} filename="ディレクトリ構造(homepage)"
/ 
├ components
├ ...
├ lib
  └ posts-util.tsx
└ posts
  └ getting-started.md
```

```md filename="posts/getting-started.mc"
---
title: Getting Started with Next.js
date: '2023-10-26'
image: vercel.svg
excerpt: NextJS is a ...
isFeatured: true
---

# title
```


## markdownファイルをNextに読み込む
- `npm install gray-matter` markdownファイルを読み込み、メタデータと本体を分割するライブラリ
- 読み込むための関数として`posts-util.ts`を用意する
- `matter()`はオブジェクトを返却し`data: { [key: string]: any}`, `content: string`プロパティを持つ
- ※型推論でかなり苦戦。要復習

```ts filename=""
import fs from "fs";
import path from "path";

import matter from "gray-matter";

type PostMetaData = {
  title: string;
  date: string;
  image: string;
  excerpt: string;
  isFeatured: boolean;
};
type MdContent = { slug: string; content: string };
type PostData = PostMetaData & MdContent;


const postsDirectory: string = path.join(process.cwd(), "posts");

function getPostData(fileName: string) {
  const filePath = path.join(postsDirectory, fileName);
  const fileContent = fs.readFileSync(filePath, "utf-8");
  const { data, content } = matter(fileContent);

  const postSlug = fileName.replace(/\.md$/, ""); // 拡張子を消す
  const postData = {
    slug: postSlug,
    content,
    title: data.title,
    date: data.date,
    image: data.image,
    excerpt: data.excerpt,
    isFeatured: data.isFeatured,
  };

  return postData;
}

export function getAllPosts() {
  const postFiles = fs.readdirSync(postsDirectory);
  const allPosts: PostData[] = postFiles.map((postFile) => getPostData(postFile));
  const sortedPosts = allPosts.sort((postA, postB) => (postA.date > postB.date ? -1 : 1));

  return sortedPosts;
}

export function getFeaturedPosts() {
  const allPosts = getAllPosts();

  const featuredPosts = allPosts.filter(post => post.isFeatured);

  return featuredPosts;
}
```