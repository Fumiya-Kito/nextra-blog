# サーバーレス

|              | サーバーレス | IaaS | オンプレミス |
| :---         | :--- | :--- | :--- |
| 課金方式     | プログラムの実行に対する従量課金	 | サーバの稼働に対する従量課金	 | システム導入時に金額が決定 |
| リソース割当    | 自動で増減（オートスケール） | 半自動で増減（個別設定が必要）	 | 固定的（サーバ調達時に大部分が決定）運用責任 |
| 運用責任範囲   | ・実行プログラム	 | ・OS<br/>・ミドルウェア<br/>・実行プログラム | ・ハードウェア<br/>・OS<br/>・ミドルウェア<br/>・実行プログラム |
| サーバーの調達 | 不要 | 物理的に用意する必要はないが初期設定が必要 | 物理的に用意する必要があり、初期設定も必要 |

サーバーレスはクラウドの利用形態の一つである。（クラウドの利用形態として代表的なものに、サーバレス、IaaS、PaaS、SaaSがある）
イベントをトリガーに機能（Function）が実行されることから、FaaS（Function as a Service）と表現されることもある

## サーバレスとは？
- 多くの場合システムを開発・運用するためには、ネットワークやサーバ等のインフラが必要
- しかし、サーバレスではインフラを自身で用意することなく、システムの開発・運用が可能になる(サーバーが不要)
- サービス事業者がすでに用意している実行環境にプログラムをアップロードし、実行条件等を設定するだけで、プログラムを実行することができる
- 利用者はサーバを管理する必要がないため、運用、保守、サーバ自体のコストの削減効果がある

- サーバレスの代表格であるAWS Lambdaは、マネジメントコンソールやAPIを利用して関数を設定します。
- Lambdaでの設定項目は以下のように少数で、コードの実装に注力することができる
1. 基本的にプログラムコード
2. ランタイム（プログラムの実行環境）
3. 実行ロール（アクセス権限）
4. メモリ量
5. タイムアウト時間

### いつ使う？
このようなサーバレスの特長から、他システムと連携が少ないシンプルなプログラムを開発・運用する場合にサーバレスが実現手段の候補に挙がる
特に、APIやIoTなどのいつ処理が必要になるかわからないが、1回の処理が短時間で終わるプログラムはコストを抑えることができることから、サーバレスが有力候補となるでしょう。


## サーバレス（FaaS）とIaaS、PaaS、SaaSとの違い

### IaaS
IaaSはInfrastructure as a Serviceの略で、サーバやネットワークなどの**インフラを丸ごと**インターネット上のサービスとして利用する形態です。
例えばサーバを利用する場合は、OSの種類をユーザーが選択して利用することが可能です。

### PaaS
PaaSは​​Platform as a Serviceの略で、**ミドルウェアやデータベースなどシステム開発に必要な環境が整ったプラットフォーム**を、インターネット上のサービスとして利用する形態です。
インフラ構築に関わる作業が必要なく、システム開発をすぐに始めることが可能です。

### SaaS
SaaSはSoftware as a Serviceの略で、従来は**パッケージ製品として提供されていたソフトウェアをインターネット経由で利用**する形態です。
代表的なサービスとして、Microsoft 365、Gmail、Dropboxが挙げられます。

### FaaS
FaaSはFunction as a Serviceの略で、プログラムの実行に必要な環境をインターネット上のサービスとして利用する形態です。サーバや各種ミドルウェアなどを用意する必要がなく、自作のプログラムをアップロードしすぐに実行することが可能です。

### 違い
- IaaS:「サーバを利用するための環境」
- PaaS:「アプリケーションを開発・実行するための環境」
- FaaS:「プログラムを実行するための環境」
- SaaS:「インターネット経由で利用するソフトフェア」

PaaSとFaaSはサーバの管理をサービス事業者に任せられる点では同じだが、
PaaSでは処理するべきリクエストの情報がほぼそのままプログラムに渡されるが、
FaaSではプログラムの実行に必要な一部の情報のみがプログラムに渡される

また、PaaSではプログラムが常時稼働しているのに対し、FaaSではリクエストを受信したタイミングでプログラムが起動する。
これより、**常時起動して処理を実施する場合にはPaaSが適しており**、特定のイベント発生時や特定の時間になったときに単発で動くプログラムなど、**常時起動する必要がない場合にはサーバレスが適している**でしょう。
一方で、**サーバやネットワークに関する要件が定められており、大規模なシステムとなる場合にはIaaS**が適しています。


## サーバレスのメリット
特長は、サーバを管理する必要がなく、プログラムの開発に人的リソースを集中できる点

### 導入コストが安い
サーバレスでは、サーバ等の物理器材を購入する必要がなく、利用量に応じて料金の発生する従量課金制であるため、導入コストを抑えることができます。
特にリクエストを受けた時のみ動作するなど、継続的に動作する必要のないプログラムの構築に向いています。
AWS Lambdaではデータの送受信が必要な時のみ自動で起動・終了し、その間に実行された処理内容に応じて料金が計算されます。

### サーバ負荷に合わせた変更が容易
サーバレスでは、プログラムの実行ごとに最適なリソースを自動で割り当ててくれます。
そのため、大量のアクセスが発生するなど想定していた負荷を上回るような場合でも、サーバが落ちることなく継続運用することが可能です。

### サーバの管理を考える必要がない
サーバレスではOSやミドルウェアのアップデートはサービス事業者が実施します。
例えば、WindowsやLinuxなどのOS、ApacheやMySQLなどのミドルウェア、PHPなどのプログラミング言語のアップデートやパッチ適用は不要です。
そのため、アップデートのための検証作業、アップデート作業中のサービス停止、また、サポート期限についても考慮する必要がないため、リプレイスを検討する必要がありません。
また、ネットワークまで含むサーバ管理をサービス事業者が担うため、負荷分散などネットワークの知識がなくてもプログラムを実装できます。

## サーバレスのデメリット
サーバレスを使用することで、IaaSやオンプレミスの課題が解決できる場合もありますが、場合によってはデメリットを被る場合があります。
例えば、ミリ秒単位の応答性が求められるプログラムや、大容量のデータを取り扱う長時間のバッチ処理が該当します。

### セキュリティの心理的不安
IaaSにも共通することですが、サーバレスは物理的に自社外にあるサーバを使用することになるため、セキュリティに不安を感じることがあるかもしれません。
しかし、サーバ自体が運用責任範囲外であり、サービス事業者がアップデートなどのセキュリティ対策を実施してくれるため、自社でセキュリティ対策を施す場合に比べるとサイバー攻撃のリスクは低いでしょう。
ただし、プログラム自体は利用者の責任となるので、セキュアなコーディングを心がける必要はあります。

### トータルコストが高くなる可能性がある
サーバレスはプログラムの実行ごとに料金が加算されていきます。
そのため、プログラムの実行回数が多い場合にはオンプレミスや他のクラウドサービスと比べて高くなる可能性があります。
例えば、常にリクエストが続いたり、サーバで常時稼働し続けるプログラムが該当します。
運用要件からコストを計算し、最適なアーキテクチャを選択しましょう。

### サービス提供事業者に依存する部分がある
サーバを管理する必要がないことから運用負担を軽減できますが、一方でプログラム言語の実行環境や障害対応などはサービス事業者に依存します。
特にサービス提供事業者を起因とする障害が発生した際には、その対応を待つことしかできないのが一般的です。
そのため、AWS Lambdaであれば複数のリージョンやアベイラビリティゾーンに分散させる、複数のサービス提供事業者のサーバレスサービスを利用するなどの障害対策をしましょう。

### 応答性が低い
サーバレスはサーバが常に起動しているわけではないため、リクエストを受けてからプログラムの実行開始までにタイムラグがあり応答性が低いです。AWS Lambdaのコールドスタートでは100ミリ秒未満から数秒ほど起動に時間がかかります。即応性が求められる場合には、サーバレス以外のサービスの利用が適しているでしょう。


## 参照
https://www.itechh.ne.jp/blog/column/server-less.html