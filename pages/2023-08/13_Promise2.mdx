# éåŒæœŸå‡¦ç†â‘¢

### ãªãœPromiseï¼Ÿã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ˜ãƒ«ã€‘
- ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§éåŒæœŸå‡¦ç†ã‚’é€£é–ã•ã›ã‚‹ã¨ã€éšå±¤ãŒæ·±ããªã‚‹ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ˜ãƒ«ï¼‰
```js filename="1ç§’ã”ã¨ã«(æ™‚é–“çµŒé-1ç§’)ã‚’è¡¨ç¤ºã•ã›ã‚‹"
function sleep(callback, n) {
  //setTimeOut=éåŒæœŸAPI ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã«é€€é¿ã•ã›ã‚‹é–¢æ•°(nç§’å¾Œã«å®Ÿè¡Œã‚’è©¦ã¿ã‚‹)
  setTimeout(function () { 
    console.log(n);
    n++
    callback(n);
  }, 1000);
}

sleep(function (n) {// 0ç§’æ™‚ç‚¹:å‘¼ã³å‡ºã— 1ç§’æ™‚ç‚¹: 0ã‚’è¡¨ç¤º
  sleep(function (n) {// 1ç§’æ™‚ç‚¹: å‘¼ã³å‡ºã—, 2ç§’æ™‚ç‚¹: 1ã‚’è¡¨ç¤º
    sleep(function (n) {
      sleep(function (n) {
        sleep(function (n) {
          sleep(function (n) {
          }, n);
        }, n);
      }, n);
    }, n);
  }, n);
}, 0);
```

- Promiseã§æ›¸ãæ›ãˆã‚‹ï¼ˆéšå±¤ãŒæ·±ããªã‚‰ãšã€å¯èª­æ€§ãŒä¸ŠãŒã‚‹ï¼‰
```js
function sleep(n) {
  return new Promise(resolve => {
    setTimeout(function () { 
      console.log(n);
      n++
      resolve(n)
    }, 1000);
  })
}

sleep(0)
  .then(n => {
    return sleep(n); // chainã•ã›ã‚‹ã«ã¯ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§Promiseã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™
  })
  .then(n => {
    return sleep(n);
  })
  .then(n => {
    return sleep(n);
  })
  .then(n => {
    return sleep(n);
  })
  .then(n => {
    return sleep(n);
  })
```

```js
// ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®è¨˜æ³•ã‚’åˆ©ç”¨ã—ã¦ä»¥ä¸‹ã§ã‚‚å®Ÿè¡Œå¯èƒ½
sleep(0)
  .then(n => sleep(n))
  .then(n => sleep(n))
  .then(n => sleep(n))
  .then(n => sleep(n))
  .then(n => sleep(n));
```
### ãƒ—ãƒ­ãƒŸã‚¹ãƒã‚§ãƒ¼ãƒ³ â†‘
- .thené–¢æ•°å†…ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§ã€Promise**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã‚’returnã™ã‚‹
- â†’æ–°ãŸã«Promiseã‚’pendingçŠ¶æ…‹ã§å§‹ã‚ã‚‹
- â†’PromiseãŒé–çŠ¶ã«ã¤ãªãŒã‚ŠéåŒæœŸå‡¦ç†ã®é †åºã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½

![Promise Chain](../../img/2023-08/promise2.png)

### éåŒæœŸå‡¦ç†ã®é †åºã‚’è¦³å¯Ÿã™ã‚‹
- ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å®Ÿè¡Œé †ã¯**å—ã‘å–ã‚‹å´ã®å•é¡Œ**
  - setTimeoutã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã«æŠ•ã’ã‚‰ã‚Œï¼ˆãƒã‚¤ã‚¯ãƒ­ã‚­ãƒ¥ãƒ¼ãŒç©ºã®å ´åˆã«1ã¤ãšã¤å®Ÿè¡Œï¼‰
  - Promiseã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã«æŠ•ã’ã‚‰ã‚Œã‚‹ï¼ˆã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãŒç©ºã«ãªã£ãŸã‚‰ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
  - å‰ã®ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚Šã€ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã€ãã®ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãŒå…ˆã«å®Ÿè¡Œã•ã‚Œã‚‹
```js filename="whenExecCallback.js"
const myFunc = ([order, pattern, funcName]) => {
  console.log(`ğŸ‘» ${order} This line is ${pattern} executed by ${funcName}`);
};

const syncCall = (callback, order) => {
  callback([order, "Synchronously", syncCall.name]);
};
const asyncAPICall = (callback, order) => {
  setTimeout(callback, 1000, [order, "Asynchronously", asyncAPICall.name])
};
const thenCall = (callback, order) => {
  return Promise.resolve([order, "Asynchronously", thenCall.name])
    .then(callback);
};

console.log("ğŸ¦– [1] MAINLINE: Sync");
asyncAPICall(myFunc, "[7]");
console.log("ğŸ¦– [2] MAINLINE: Sync");
thenCall(myFunc, "[6]");
console.log("ğŸ¦– [3] MAINLINE: Sync");
syncCall(myFunc, "[4]");
console.log("ğŸ¦– [5] MAINLINE: Sync");
```

```shell
ğŸ¦– [1] MAINLINE: Sync
ğŸ¦– [2] MAINLINE: Sync
ğŸ¦– [3] MAINLINE: Sync
ğŸ‘» [4] This line is Synchronously executed by syncCall
ğŸ¦– [5] MAINLINE: Sync
ğŸ‘» [6] This line is Asynchronously executed by thenCall
ğŸ‘» [7] This line is Asynchrouously executed by asyncAPICall
```

### å‚ç…§
- https://zenn.dev/tana0102/articles/5a73971ad05c92
- https://qiita.com/sho_U/items/ff82aa576837198097ce